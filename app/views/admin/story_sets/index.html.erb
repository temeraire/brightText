<script>
  $( function() {
    $("#new_button").button().click( function(){
       document.location.href='/admin/story_sets/new?filter=<%= @filter %>';
    });
  });
  
  function onFilterSelect()
  {
    var selector =  $("#filterSelector")[0];
    document.location.href = "/admin/story_sets?filter=" + selector.options[ selector.selectedIndex ].value;
  }  
</script>

<div style="height=60px; width:100px">&nbsp;</div>
<button id="new_button" style="float:left">New <%= session[:style].set_alias.titleize %></button>
<div class="toolbar" style="float:left; padding:5px 0px 0px 100px;">Show For <%= session[:style].group_alias.titleize %>:
<select id="filterSelector" onChange="onFilterSelect()">
<%
  selected = 'selected' if @filter.blank?
%>
 <option <%= selected %> value="__none" >All<%= @application.blank? ? "" : " in " + @application.name %></option>
<%
  selected = ''
  selected = 'selected' if @filter == "__unassigned"
%>
 <option <%= selected %> value="__unassigned">-- unassigned --</option>
<%

  @categories.each do | category |
    selected = ''
    selected = 'selected' if @filter == category.id.to_s    
%>
    <option value="<%=category.id%>" <%= selected %>><%= category.name %></option>
<%
  end if @categories
%>
</select>
<% if(@filter != "__none" && !@category.blank?) %>
	<button onclick="window.location.assign('<%= admin_reorder_story_sets_rank_path(@category) %>')">Reorder StorySets</button>
<% else %>	
	<button disabled="disabled" >Reorder StorySets</button>
<% end %>
<%
  parentObj = StorySetCategory.find_by_id( @filter )
  parentId = "__undefined"
  parentId = parentObj.application_id.to_s unless parentObj == nil
%>
<!-- <a href="/admin/story_set_categories?filter=<%#= parentId %>">Back To <%#= session[:style].group_alias.titleize %></a> -->
</div>


<div style="height:110px; width:100px">&nbsp;</div>


<table class="sortable_header" >
	<thead>  
		<tr>
		    <th style="width:55px" data-sort="int" ><b>Order</b></th>
		    <th style="width:300px" data-sort="string" ><b>Name</b><span class="arrow">&darr;</span></th>
		    <th style="width:55px"></th>
		    <th style="width:55px"></th> 
                    <th style="width:150px"></th>
		    <th data-sort="int" ><b><%= session[:style].story_alias.pluralize.titleize %></b></th>
		    <th></th>
		 </tr>
	</thead>
	<tbody>
		<% @story_sets.each do |story_set|
		  countQuery = StorySet.find_by_sql ["select count( id ) as count from stories where story_set_id = ?", story_set.id ]
		  count = countQuery[0].count
		  label = session[:style].story_alias
		  label = label.pluralize unless count == 1
		%>
		  <tr class="info_row">
		    <td style="width:50px"><%= story_set.rank %></td>  
                    <td style="width:250px"><a href="/admin/stories?filter=<%= story_set.id %>"><%=story_set.name%></a></td>    
		    <td style="text-align: left;"><%= link_to 'Clone', clone_admin_story_set_path(story_set)%></td>
		    <td style="text-align: left;"><%= link_to 'Delete', admin_story_set_path(story_set), :confirm => 'Are you sure?', :method => :delete %></td>
		    <td style="text-align: left;"><%= link_to 'Properties', edit_admin_story_set_path(story_set) %></td>
                    <td><a href="/admin/stories?filter=<%= story_set.id %>"><%= count %> <%= label %> </a></td>  
		    
		  </tr>
		<% end %>
	</tbody>
</table>



