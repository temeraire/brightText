<script src="/js/btedit.js" type="text/javascript"></script>
<link rel=StyleSheet href="/stylesheets/btedit.css" type="text/css" media="screen">
<style type="text/css" media="screen">

/*  body {
    margin: 0;
    margin-bottom: 25px;
    padding: 0;
    background-color: #f0f0f0;
    font-family: "Lucida Grande", "Bitstream Vera Sans", "Verdana";
    font-size: 13px;
    color: #333;
    overflow:hidden;        
  } 
  
  textarea.dataport{
    width:764px; 
    height:392px; 
    resize:none;
  }
  
  div.harnesscontainer{
    width:834px; 
    height:34px; 
    margin:5px; 
    padding:5px; 
    float:left;  
    border: 1px dotted black
  }      
  
  div.viewportcontainer{
    width:770px; 
    height:400px; 
    margin:5px; 
    padding:5px; 
    float:left;  
    border: 1px dotted black
  }
  
  div.btEditor{
    width:748px;
    height:314px;
    padding:10px;
  }
  */.no-close .ui-dialog-titlebar-close {display: none }
</style>


<!--<script>
  function onSetSelect()
  {
    var selector =  $("#setSelector")[0];
    $("#storySetId")[0].value = selector.options[ selector.selectedIndex ].value;
  }
  
  function saveStory(){
  	var form, type;
  	
    // try{
      // $(".edit_story")[0].submit();
    // } catch (e) {}
    // try{
      // $(".new_story")[0].submit();  
    // } catch (e) {}

    if($(".new_story")[0] == undefined){
    	form = $(".edit_story")[0];
    	type = "PUT";
    }
    else{
    	form = $(".new_story")[0];
    	type = "POST";
    }
    $.ajax({
    	type: $(form).attr("method"),
    	url: $(form).attr("action"),
    	data: $(form).serialize(),
    	dataType: "json",
    	success: function(data){
    				settings = window[$('form[data-validate]').attr('id')];
    				element = $("#story_name");
    				clientSideValidations.formBuilders[settings.type].remove(element, settings);
    				if(data["success"] == "true") {
              console.log(data);
    					show_response_dialog("Story saved successfully", "Success!");
              if(data["story_id"] != null) { // If the story was just created
                // Change form class to "edit_story"
                $(form).removeClass('new_story');
                $(form).addClass('edit_story');
                $(form).attr('action', "/stories/" + data["story_id"]);
                $(form).attr('method', 'PUT');
              }
            }
    				else if(data["name"]){    					
    					message = data["name"];
    					clientSideValidations.formBuilders[settings.type].add(element, settings, message);
    				}
    					
    				else
    					show_response_dialog("Something went wrong! Please try again later.", "Failed!");
    			}
    });
  }  
  
  function show_response_dialog(dialog_text, dialog_title){
  	$("#dialog p").html(dialog_text);
    $("#dialog").attr("title", dialog_title);
  	$( "#dialog" ).dialog({
    	autoOpen: true,
    	resizable: false,
    	show: {effect: "fadeOut", duration: 500},
    	hide: {effect: "fadeOut", duration: 500},
    	dialogClass: 'no-close' 
    });
  	//$( "#dialog" ).dialog( "open" );
  	setTimeout(function(){$( "#dialog" ).dialog("close")},2500);
  }
</script>

<script>
  $(function(){
   $("#save_story_btn").button(); 
   $("#back_btn").button().click( function(e){
    e.preventDefault();
    document.location.href='/stories?filter=<%=@story.story_set_id.to_s%>'; 
    return false;    
   }); 
  });
</script> -->


<!-- BrightText WAND script -->
<!--<script>
  var _bt1 = null;
  
  function updateToneSlider1( gradients, value )
  { 
    var toneIndex = 0;
    for ( var i = 0; i < gradients.length; i++ ){
      if ( gradients[i].id == value ){
        toneIndex = i; 
        break;
      }
    }
    $("#tone-control1").hide( );
    $( "#slider1" ).slider({
      value: toneIndex,
      min: 0,
      max: gradients.length - 1,
      range: false,
      step: 0.001,
      slide: function( event, ui ) {
        var toneGradients = gradients;
        var s1 = Math.round(ui.value);
        if ( _s1 != s1 ){ // allow smooth moving of the tone selector
          _s1 = s1;            
          $( "#gradient1" ).html( gradients[ s1 ].name );
          _bt1.handleToneSelection( gradients[ s1 ].id ); 
        }
      }
    });   
    if ( gradients.length > 1) {
      $( "#gradient1" ).html( gradients[ toneIndex ].name );
      $("#tone-control1").show();
    }
  }      
  
  var _s1;
  
  
  $(document).ready(function(){
    
    _bt1 = new BrightTextEditor( "bt_one", true );
    
    var rawData  = $("#fieldDescriptor");
    var textData = $("#fieldSummary");
    
    _bt1.onChange( function() {
      rawData[0].value  = $.toJSON( _bt1.toData() );
      textData[0].value = _bt1.toString();
      updateToneSlider1( _bt1.toneGradients(), _bt1.selectedTone() );
    } );
   
    $("#instant_rewrite1").button();
    $("#instant_rewrite1").bind("click", function(){
      _bt1.rewrite();
    });
  
   
    $("#tone-control1").hide( );
    
    $("#fetchStory").button();
    $("#saveStory").button();
  
    $("#edit_choicesets").button().click( _bt1.editChoicesets );  	
  	
  //set client_side_validation for selection list
   $("#story_story_set_id").change(function(){
		var settings = window[$('form[data-validate]').attr('id')];
		$("#story_name").isValid(settings.validators);	
   });	
  
<%  if    @story.descriptor != nil &&  !@story.descriptor.empty?  %>
    _bt1.renderData( <%=raw @story.descriptor %> );  
<%   end   %>  
  });


</script>
-->


<div style="width:700px; height:50px">
<%= form_for(@story, :validate => true) do |f| %>
  <div class="field form-field" style="float:left; padding-right:60px; width:700px">
    <div class="form-field-label">Name:</div>
    <div class="form-field-value"><%= f.text_field :name, :onfocus=>"this.value = this.value;" %></div>
  </div>
  <div class="field form-field" style="float:left; padding-right:60px; width:700px">
    <div class="form-field-label"><%= session[:style].set_alias.titleize %>:</div>
    <div class="form-field-value">
    	<%= f.select :story_set_id, options_from_collection_for_select(StorySet.where(:domain_id => session[:domain].id), :id, :name, @story.story_set_id)%>
    </div>
    
  </div> 
  <%= f.hidden_field :description, :id => "fieldSummary" %>
  <%= f.hidden_field :descriptor,  :id => "fieldDescriptor" %>
</div>
<% end %>


<div style="width:700px; height:450px">
<!--   WAND WAND WAND WAND WAND  -->
  <div id="main_container" class="viewportcontainer">
    <div id="controls1" style="width:748px; height:43px;padding:2px;margin:5px" class="ui-widget-header ui-corner-all">
    
      
      <div style="border: 0px dashed grey; width:180px; padding:5px 5px 2px 10px;float:left">
        <button id="edit_choicesets">Choicesets</button>
      </div>
      <div style="float:right; padding: 5px 0px;">
        <button id="instant_rewrite1">Instant Rewrite</button>
      </div>  
      <div style="border: 0px dashed grey; width:200px; padding:2px 25px 5px 10px;float:right" id="tone-control1">
        <div id="gradient1" style="float:right; padding: 0px 0px 0px 0px; font-weight:bold;"></div>
        <div style="padding:0px 0px 5px 0px;">Tone: </div>
        <div id="slider1" style="width:100%;"></div>
      </div>          
                
    </div>   
  
    <div id="bt_one" class="btEditor">BT Wand</div>


  </div>
</div>


<!--   END WAND END WAND END WAND  -->

  <div class="actions">
    <button style="height:28px; margin-right:420px" id="back_btn">Back</button><button onclick='saveStory()'id="save_story_btn"> Save </button>
  </div>
  
  <div id="dialog" title="Basic dialog" display="none" >
    <p></p>
  </div>
  

