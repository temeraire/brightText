<script src="/js/btedit.js" type="text/javascript"></script>
<link rel=StyleSheet href="/stylesheets/btedit.css" type="text/css" media="screen">
<style type="text/css" media="screen">

  body {
    margin: 0;
    margin-bottom: 25px;
    padding: 0;
    background-color: #f0f0f0;
    font-family: "Lucida Grande", "Bitstream Vera Sans", "Verdana";
    font-size: 13px;
    color: #333;
    overflow:hidden;        
  } 
  
  textarea.dataport{
    width:764px; 
    height:392px; 
    resize:none;
  }
  
  div.harnesscontainer{
    width:834px; 
    height:34px; 
    margin:5px; 
    padding:5px; 
    float:left;  
    border: 1px dotted black
  }      
  
  div.viewportcontainer{
    width:770px; 
    height:400px; 
    margin:5px; 
    padding:5px; 
    float:left;  
    border: 1px dotted black
  }
  
  div.btEditor{
    width:748px;
    height:314px;
    padding:10px;
  }
  
</style>


<script>
  function onSetSelect()
  {
    var selector =  $("#setSelector")[0];
    $("#storySetId")[0].value = selector.options[ selector.selectedIndex ].value;
  }
  
  function saveStory(){
    try{
      $(".edit_story")[0].submit();
    } catch (e) {}
    try{
      $(".new_story")[0].submit();  
    } catch (e) {}
  }
  
</script>

<script>
  $(function(){
   $("#save_story_btn").button(); 
   $("#back_btn").button().click( function(e){
    e.preventDefault();
    document.location.href='/stories'; 
    return false;    
   }); 
  });
</script>


<!-- BrightText WAND script -->
<script>
  var _bt1 = null;
  
  function updateToneSlider1( gradients, value )
  { 
    var toneIndex = 0;
    for ( var i = 0; i < gradients.length; i++ ){
      if ( gradients[i].id == value ){
        toneIndex = i; 
        break;
      }
    }
    $("#tone-control1").hide( );
    $( "#slider1" ).slider({
      value: toneIndex,
      min: 0,
      max: gradients.length - 1,
      range: false,
      step: 0.001,
      slide: function( event, ui ) {
        var toneGradients = gradients;
        var s1 = Math.round(ui.value);
        if ( _s1 != s1 ){ // allow smooth moving of the tone selector
          _s1 = s1;            
          $( "#gradient1" ).html( gradients[ s1 ].name );
          _bt1.handleToneSelection( gradients[ s1 ].id ); 
        }
      }
    });   
    if ( gradients.length > 1) {
      $( "#gradient1" ).html( gradients[ toneIndex ].name );
      $("#tone-control1").show();
    }
  }      
  
  var _s1;
  
  
  $(document).ready(function(){
    _bt1 = new BrightTextEditor( "bt_one", true );
    
    var rawData  = $("#fieldDescriptor");
    var textData = $("#fieldSummary");
    
    _bt1.onChange( function() {
      rawData[0].value  = $.toJSON( _bt1.toData() );
      textData[0].value = _bt1.toString();
      updateToneSlider1( _bt1.toneGradients(), _bt1.selectedTone() );
    } );
   
    $("#instant_rewrite1").button();
    $("#instant_rewrite1").bind("click", function(){
      _bt1.rewrite();
    });
  
   
    $("#tone-control1").hide( );
    
    $("#fetchStory").button();
    $("#saveStory").button();
  
    $("#edit_choicesets").button().click( _bt1.editChoicesets );
  
  
<%  if    @story.descriptor != nil &&  !@story.descriptor.empty?  %>
    _bt1.renderData( <%=raw @story.descriptor %> );  
<%   end   %>  
  });


</script>


<div style="width:700px; height:50px">
<%= form_for(@story) do |f| %>
  <div class="field form-field" style="float:left; padding-right:20px;">
    Name:
    <%= f.text_field :name %>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  
    Set:
    <select onChange="onSetSelect()" id="setSelector">
    <% 
      sets = StorySet.find_by_sql ["select * from story_sets where domain_id = ?", session[:domain].id ]
      sets.each do | set |
        selected = "selected='true'" if set.id == @story.story_set_id 
     %>
         <option <%= selected %> value="<%= set.id %>"><%= set.name %></option>
     <%
       end
    %>    
    </select>
    <%= f.hidden_field :story_set_id, :id=>:storySetId, :value => sets[0].id %>
    
  </div>
  
  

  <%= f.hidden_field :description, :id => "fieldSummary" %>
  <%= f.hidden_field :descriptor,  :id => "fieldDescriptor" %>
</div>
<% end %>


<div style="width:700px; height:450px">
<!--   WAND WAND WAND WAND WAND  -->
  <div id="main_container" class="viewportcontainer">
    <div id="controls1" style="width:748px; height:43px;padding:2px;margin:5px" class="ui-widget-header ui-corner-all">
    
      
      <div style="border: 0px dashed grey; width:180px; padding:5px 5px 2px 10px;float:left">
        <button id="edit_choicesets">Choicesets</button>
      </div>
      <div style="float:right; padding: 5px 0px;">
        <button id="instant_rewrite1">Instant Rewrite</button>
      </div>  
      <div style="border: 0px dashed grey; width:200px; padding:2px 25px 5px 10px;float:right" id="tone-control1">
        <div id="gradient1" style="float:right; padding: 0px 0px 0px 0px; font-weight:bold;"></div>
        <div style="padding:0px 0px 5px 0px;">Tone: </div>
        <div id="slider1" style="width:100%;"></div>
      </div>          
                
    </div>   
  
    <div id="bt_one" class="btEditor">BT Wand</div>


  </div>
</div>


<!--   END WAND END WAND END WAND  -->

  <div class="actions">
    <button style="height:28px; margin-right:420px" id="back_btn">Back</button><button onclick='saveStory()'id="save_story_btn"> Save </button>
  </div>

